---
/**
 * ComparisonTable - Típus összehasonlító táblázat
 *
 * Újrafelhasználható: T12/T14/T20/T25 "helyett" oldalakhoz
 * és a /trapezlemez-tipusok/ hub oldalhoz.
 */

interface ComparisonRow {
  label: string;
  competitor: string;
  ours: string;
  highlight?: boolean;
}

interface Props {
  /** A versenytárs típusa, pl. "T12 0.4mm" */
  competitorName: string;
  /** A mi termékünk neve, pl. "T18 0.5mm" */
  ourName: string;
  /** Összehasonlító sorok */
  rows: ComparisonRow[];
  /** Teljes táblázat megjelenítés (minden típussal) */
  showAll?: boolean;
}

const { competitorName, ourName, rows, showAll = false } = Astro.props;

const allTypesData = [
  { type: 'T12 0.4mm', shapeFactor: 1.02, bending: 0.065, strength: 100, support: '60cm', purlins: 10 },
  { type: 'T14 0.4mm', shapeFactor: 1.05, bending: 0.067, strength: 103, support: '70cm', purlins: 9 },
  { type: 'T20 0.4mm', shapeFactor: 1.12, bending: 0.072, strength: 111, support: '80cm', purlins: 8 },
  { type: 'T25 0.4mm', shapeFactor: 1.18, bending: 0.076, strength: 117, support: '90cm', purlins: 7 },
  { type: 'T18 0.5mm', shapeFactor: 1.08, bending: 0.135, strength: 208, support: '100cm', purlins: 6, ours: true },
  { type: 'T18 0.6mm', shapeFactor: 1.08, bending: 0.233, strength: 358, support: '120cm', purlins: 5, ours: true },
];
---

{showAll ? (
  <div class="comparison-wrapper">
    <div class="table-responsive">
      <table class="comparison-table comparison-table--full">
        <thead>
          <tr>
            <th>Típus</th>
            <th>Alaktényező</th>
            <th>Hajlítási ell.</th>
            <th>Relatív erősség</th>
            <th>Max alátámasztás</th>
            <th>Szelemen (6m)</th>
          </tr>
        </thead>
        <tbody>
          {allTypesData.map((row) => (
            <tr class:list={[{ 'row-highlight': row.ours }]}>
              <td class="cell-type">
                {row.type}
                {row.ours && <span class="badge-ours">Nálunk</span>}
              </td>
              <td>{row.shapeFactor}</td>
              <td>{row.bending}</td>
              <td class="cell-strength">
                <div class="strength-bar-mini">
                  <div class="strength-fill" style={`width: ${Math.min(row.strength / 3.58 * 100, 100)}%`}></div>
                </div>
                <span>{row.strength}%</span>
              </td>
              <td>{row.support}</td>
              <td>{row.purlins} db</td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
    <p class="comparison-note">
      Számítás: Eurocode 3 (MSZ EN 1993-1-3) alapján, egyenletesen megoszló terhelésre.
      Farkas Roland, gépészmérnök (BMF) által ellenőrizve.
    </p>
  </div>
) : (
  <div class="comparison-wrapper">
    <div class="table-responsive">
      <table class="comparison-table">
        <thead>
          <tr>
            <th></th>
            <th class="col-competitor">{competitorName}<br/><span class="col-sub">máshol</span></th>
            <th class="col-ours">{ourName}<br/><span class="col-sub">nálunk</span></th>
          </tr>
        </thead>
        <tbody>
          {rows.map((row) => (
            <tr class:list={[{ 'row-highlight': row.highlight }]}>
              <td class="cell-label">{row.label}</td>
              <td class="cell-competitor">{row.competitor}</td>
              <td class="cell-ours">{row.ours}</td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
    <p class="comparison-note">
      Számítás: Eurocode 3 (MSZ EN 1993-1-3) alapján, egyenletesen megoszló terhelésre.
      Farkas Roland, gépészmérnök (BMF) által ellenőrizve.
    </p>
  </div>
)}

<style>
  .comparison-wrapper {
    margin: var(--spacing-xl) 0;
  }

  .table-responsive {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  .comparison-table {
    width: 100%;
    border-collapse: collapse;
    font-size: var(--font-size-sm);
  }

  .comparison-table th,
  .comparison-table td {
    padding: var(--spacing-sm) var(--spacing-md);
    text-align: left;
    border-bottom: 1px solid var(--color-border);
  }

  .comparison-table thead th {
    background: var(--color-bg-light);
    font-weight: 700;
    font-size: var(--font-size-sm);
    white-space: nowrap;
  }

  .col-competitor {
    color: var(--color-text-light);
  }

  .col-ours {
    color: var(--color-primary-dark);
  }

  .col-sub {
    font-weight: 400;
    font-size: 0.75rem;
    opacity: 0.7;
  }

  .cell-label {
    font-weight: 600;
    white-space: nowrap;
  }

  .cell-competitor {
    color: var(--color-text-light);
  }

  .cell-ours {
    color: var(--color-primary-dark);
    font-weight: 700;
  }

  .row-highlight {
    background: #e8f5e9;
  }

  .row-highlight td {
    font-weight: 600;
  }

  /* Full table styles */
  .comparison-table--full .cell-type {
    font-weight: 700;
    white-space: nowrap;
  }

  .badge-ours {
    display: inline-block;
    background: var(--color-primary);
    color: white;
    font-size: 0.65rem;
    font-weight: 700;
    padding: 1px 6px;
    border-radius: var(--radius-full);
    margin-left: var(--spacing-xs);
    vertical-align: middle;
  }

  .cell-strength {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    min-width: 140px;
  }

  .strength-bar-mini {
    flex: 1;
    height: 8px;
    background: var(--color-bg-dark);
    border-radius: var(--radius-full);
    overflow: hidden;
  }

  .strength-fill {
    height: 100%;
    background: var(--color-primary);
    border-radius: var(--radius-full);
    transition: width 0.3s ease;
  }

  .row-highlight .strength-fill {
    background: var(--color-primary-dark);
  }

  .cell-strength span {
    font-weight: 700;
    font-size: var(--font-size-sm);
    min-width: 45px;
    text-align: right;
  }

  .comparison-note {
    font-size: 0.75rem;
    color: var(--color-text-muted);
    font-style: italic;
    margin-top: var(--spacing-sm);
  }

  @media (max-width: 640px) {
    .comparison-table th,
    .comparison-table td {
      padding: var(--spacing-xs) var(--spacing-sm);
      font-size: 0.8rem;
    }
  }
</style>
